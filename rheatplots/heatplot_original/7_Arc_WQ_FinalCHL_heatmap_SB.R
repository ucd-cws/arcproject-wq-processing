
#packages
library(plyr)
library(gplots)
library(grDevices)

##open each monthly file, daily r2 values, and template to facilitate joins
r2 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_r2.csv")
blank <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_BLANK_SBwqtst.csv")
Mar13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Mar2013_WQt_gn0_cor_snapped.csv",stringsAsFactors=FALSE)
Mar13 <- subset(Mar13,Mar13$RID=='SB')
Apr13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Apr2013_WQt_gn0_cor_snapped.csv",stringsAsFactors=FALSE)
Apr13 <- subset(Apr13,Apr13$RID=='SB')
May13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_May2013_WQt_gn0_cor_snapped.csv",stringsAsFactors=FALSE)
May13 <- subset(May13,May13$RID=='SB')
Jun13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jun2013_WQt_gn0_cor_snapped.csv",stringsAsFactors=FALSE)
Jun13 <- subset(Jun13,Jun13$RID=='SB')
Jul13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jul2013_WQt_gn0_cor_snapped.csv",stringsAsFactors=FALSE)
Jul13 <- subset(Jul13,Jul13$RID=='SB')
Aug13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Aug2013_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Aug13 <- subset(Aug13,Aug13$RID=='SB')
Sep13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Sep2013_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Sep13 <- subset(Sep13,Sep13$RID=='SB')
Oct13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Oct2013_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Oct13 <- subset(Oct13,Oct13$RID=='SB')
Nov13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Nov2013_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Nov13 <- subset(Nov13,Nov13$RID=='SB')
Dec13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Dec2013_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Dec13 <- subset(Dec13,Dec13$RID=='SB')
Jan14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jan2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Jan14 <- subset(Jan14,Jan14$RID=='SB')
Feb14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Feb2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Feb14 <- subset(Feb14,Feb14$RID=='SB')
Mar14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Mar2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Mar14 <- subset(Mar14,Mar14$RID=='SB')
Apr14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Apr2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Apr14 <- subset(Apr14,Apr14$RID=='SB')
May14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_May2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
May14 <- subset(May14,May14$RID=='SB')
Jun14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jun2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Jun14 <- subset(Jun14,Jun14$RID=='SB')
Jul14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jul2014_WQt_gn1_gn10_cor_snapped.csv",stringsAsFactors=FALSE)
Jul14 <- subset(Jul14,Jul14$RID=='SB')
Aug14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Aug2014_WQt_gn1_gn10_gn100_cor_snapped.csv",stringsAsFactors=FALSE)
Aug14 <- subset(Aug14,Aug14$RID=='SB')
Sep14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Sep2014_WQt_gn1_gn10_gn100_cor_snapped.csv",stringsAsFactors=FALSE)
Sep14 <- subset(Sep14,Sep14$RID=='SB')
Oct14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Oct2014_WQt_gn1_gn10_gn100_cor_snapped.csv",stringsAsFactors=FALSE)
Oct14 <- subset(Oct14,Oct14$RID=='SB')
Nov14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Nov2014_WQt_gn1_gn10_gn100_cor_snapped.csv",stringsAsFactors=FALSE)
Nov14 <- subset(Nov14,Nov14$RID=='SB')
Dec14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Dec2014_WQt_gn1_gn10_gn100_cor_snapped.csv",stringsAsFactors=FALSE)
Dec14 <- subset(Dec14,Dec14$RID=='SB')

##subset data (only need Date, CHL, RID, and MEAS)
Mar13<- subset(Mar13, select=c(RID, MEAS, Date, Mar13_CHL, Mar13_NewCHL))
Apr13<- subset(Apr13, select=c(RID, MEAS, Date, Apr13_CHL, Apr13_NewCHL))
May13<- subset(May13, select=c(RID, MEAS, Date, May13_CHL, May13_NewCHL))
Jun13<- subset(Jun13, select=c(RID, MEAS, Date, Jun13_CHL, Jun13_NewCHL))
Jul13<- subset(Jul13, select=c(RID, MEAS, Date, Jul13_CHL, Jul13_NewCHL))
Aug13<- subset(Aug13, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Sep13<- subset(Sep13, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Oct13<- subset(Oct13, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Nov13<- subset(Nov13, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Dec13<- subset(Dec13, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Jan14<- subset(Jan14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Feb14<- subset(Feb14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Mar14<- subset(Mar14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Apr14<- subset(Apr14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
May14<- subset(May14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Jun14<- subset(Jun14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Jul14<- subset(Jul14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1))
Aug14<- subset(Aug14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1 ,NewCHL_g_2))
Sep14<- subset(Sep14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1 ,NewCHL_g_2))
Oct14<- subset(Oct14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1 ,NewCHL_g_2))
Nov14<- subset(Nov14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1 ,NewCHL_g_2))
Dec14<- subset(Dec14, select=c(RID, MEAS, Date, CHL,NewCHL_gn1 ,NewCHL_g_1 ,NewCHL_g_2))

#Workaround to make sure MEASURE column match eachother - this is done to facilitate join
blank$MEASURE <-paste(round(blank$MEASURE))
Mar13$MEASURE <-paste(round(Mar13$MEAS))
Apr13$MEASURE <-paste(round(Apr13$MEAS))
May13$MEASURE <-paste(round(May13$MEAS))
Jun13$MEASURE <-paste(round(Jun13$MEAS))
Jul13$MEASURE <-paste(round(Jul13$MEAS))
Aug13$MEASURE <-paste(round(Aug13$MEAS))
Sep13$MEASURE <-paste(round(Sep13$MEAS))
Oct13$MEASURE <-paste(round(Oct13$MEAS))
Nov13$MEASURE <-paste(round(Nov13$MEAS))
Dec13$MEASURE <-paste(round(Dec13$MEAS))
Jan14$MEASURE <-paste(round(Jan14$MEAS))
Feb14$MEASURE <-paste(round(Feb14$MEAS))
Mar14$MEASURE <-paste(round(Mar14$MEAS))
Apr14$MEASURE <-paste(round(Apr14$MEAS))
May14$MEASURE <-paste(round(May14$MEAS))
Jun14$MEASURE <-paste(round(Jun14$MEAS))
Jul14$MEASURE <-paste(round(Jul14$MEAS))
Aug14$MEASURE <-paste(round(Aug14$MEAS))
Sep14$MEASURE <-paste(round(Sep14$MEAS))
Oct14$MEASURE <-paste(round(Oct14$MEAS))
Nov14$MEASURE <-paste(round(Nov14$MEAS))
Dec14$MEASURE <-paste(round(Dec14$MEAS))

##joining r2 value
Mar13_r2 <- merge(Mar13,r2,by="Date",all.x = TRUE)
Apr13_r2 <- merge(Apr13,r2,by="Date",all.x = TRUE)
May13_r2 <- merge(May13,r2,by="Date",all.x = TRUE)
Jun13_r2 <- merge(Jun13,r2,by="Date",all.x = TRUE)
Jul13_r2 <- merge(Jul13,r2,by="Date",all.x = TRUE)
Aug13_r2 <- merge(Aug13,r2,by="Date",all.x = TRUE)
Sep13_r2 <- merge(Sep13,r2,by="Date",all.x = TRUE)
Oct13_r2 <- merge(Oct13,r2,by="Date",all.x = TRUE)
Nov13_r2 <- merge(Nov13,r2,by="Date",all.x = TRUE)
Dec13_r2 <- merge(Dec13,r2,by="Date",all.x = TRUE)
Jan14_r2 <- merge(Jan14,r2,by="Date",all.x = TRUE)
Feb14_r2 <- merge(Feb14,r2,by="Date",all.x = TRUE)
Mar14_r2 <- merge(Mar14,r2,by="Date",all.x = TRUE)
Apr14_r2 <- merge(Apr14,r2,by="Date",all.x = TRUE)
May14_r2 <- merge(May14,r2,by="Date",all.x = TRUE)
Jun14_r2 <- merge(Jun14,r2,by="Date",all.x = TRUE)
Jul14_r2 <- merge(Jul14,r2,by="Date",all.x = TRUE)
Aug14_r2 <- merge(Aug14,r2,by="Date",all.x = TRUE)
Sep14_r2 <- merge(Sep14,r2,by="Date",all.x = TRUE)
Oct14_r2 <- merge(Oct14,r2,by="Date",all.x = TRUE)
Nov14_r2 <- merge(Nov14,r2,by="Date",all.x = TRUE)
Dec14_r2 <- merge(Dec14,r2,by="Date",all.x = TRUE)

##Implementing decision tree
Mar13_r2$Mar13_Final_CHL <- paste(ifelse(Mar13_r2$Gain0 < .8, Mar13_r2$Mar13_CHL , Mar13_r2$Mar13_NewCHL))
Mar13_r2$Mar13_Final_CHL_note <- paste(ifelse(Mar13_r2$Gain0 < .8, "Uncorrected chl" , "Gain 0"))
Apr13_r2$Apr13_Final_CHL <- paste(ifelse(Apr13_r2$Gain0 < .8 | is.na(Apr13_r2$Gain0), Apr13_r2$Apr13_CHL , Apr13_r2$Apr13_NewCHL))
Apr13_r2$Apr13_Final_CHL_note <- paste(ifelse(Apr13_r2$Gain0 < .8 | is.na(Apr13_r2$Gain0), "Uncorrected chl" , "Gain 0"))
May13_r2$May13_Final_CHL <- paste(ifelse(May13_r2$Gain0 < .8, May13_r2$May13_CHL , May13_r2$May13_NewCHL))
May13_r2$May13_Final_CHL_note <- paste(ifelse(May13_r2$Gain0 < .8, "Uncorrected chl" , "Gain 0"))
Jun13_r2$Jun13_Final_CHL <- paste(ifelse(Jun13_r2$Gain0 < .8, Jun13_r2$Jun13_CHL , Jun13_r2$Jun13_NewCHL))
Jun13_r2$Jun13_Final_CHL_note <- paste(ifelse(Jun13_r2$Gain0 < .8, "Uncorrected chl" , "Gain 0"))
Jul13_r2$Jul13_Final_CHL <- paste(ifelse(Jul13_r2$Date == "7/2/2013", ifelse(Jul13_r2$Jul13_CHL < 45, ifelse(Jul13_r2$Gain1 < .8, Jul13_r2$Jul13_CHL, Jul13_r2$NewCHL_gn1), ifelse(Jul13_r2$Gain10 < .8,Jul13_r2$Jul13_CHL, Jul13_r2$NewCHL_g_1)),ifelse(Jul13_r2$Gain0 < .8, Jul13_r2$Jul13_CHL , Jul13_r2$Jul13_NewCHL)))                   
Jul13_r2$Jul13_Final_CHL_note <- paste(ifelse(Jul13_r2$Date == "7/2/2013", ifelse(Jul13_r2$Jul13_CHL < 45, ifelse(Jul13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1"), ifelse(Jul13_r2$Gain10 < .8,"Uncorrected chl", "Gain 10")),ifelse(Jul13_r2$Gain0 < .8, "Uncorrected chl" , "Gain 0")))                   
Aug13_r2$Aug13_Final_CHL <- paste(ifelse(Aug13_r2$CHL < 45, ifelse(Aug13_r2$Gain10 < .8, Aug13_r2$CHL, Aug13_r2$NewCHL_g_1), ifelse(Aug13_r2$Gain1 < .8, Aug13_r2$CHL, Aug13_r2$NewCHL_gn1)))
Aug13_r2$Aug13_Final_CHL_note <- paste(ifelse(Aug13_r2$CHL < 45, ifelse(Aug13_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Aug13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Sep13_r2$Sep13_Final_CHL <- paste(ifelse(Sep13_r2$CHL < 45, ifelse(Sep13_r2$Gain10 < .8, Sep13_r2$CHL, Sep13_r2$NewCHL_g_1), ifelse(Sep13_r2$Gain1 < .8, Sep13_r2$CHL, Sep13_r2$NewCHL_gn1)))
Sep13_r2$Sep13_Final_CHL_note <- paste(ifelse(Sep13_r2$CHL < 45, ifelse(Sep13_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Sep13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Oct13_r2$Oct13_Final_CHL <- paste(ifelse(Oct13_r2$CHL < 45, ifelse(Oct13_r2$Gain10 < .8, Oct13_r2$CHL, Oct13_r2$NewCHL_g_1), ifelse(Oct13_r2$Gain1 < .8, Oct13_r2$CHL, Oct13_r2$NewCHL_gn1)))
Oct13_r2$Oct13_Final_CHL_note <- paste(ifelse(Oct13_r2$CHL < 45, ifelse(Oct13_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Oct13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Nov13_r2$Nov13_Final_CHL <- paste(ifelse(Nov13_r2$CHL < 45, ifelse(Nov13_r2$Gain10 < .8, Nov13_r2$CHL, Nov13_r2$NewCHL_g_1), ifelse(Nov13_r2$Gain1 < .8, Nov13_r2$CHL, Nov13_r2$NewCHL_gn1)))
Nov13_r2$Nov13_Final_CHL_note <- paste(ifelse(Nov13_r2$CHL < 45, ifelse(Nov13_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Nov13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Dec13_r2$Dec13_Final_CHL <- paste(ifelse(Dec13_r2$CHL < 45, ifelse(Dec13_r2$Gain10 < .8, Dec13_r2$CHL, Dec13_r2$NewCHL_g_1), ifelse(Dec13_r2$Gain1 < .8, Dec13_r2$CHL, Dec13_r2$NewCHL_gn1)))
Dec13_r2$Dec13_Final_CHL_note <- paste(ifelse(Dec13_r2$CHL < 45, ifelse(Dec13_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Dec13_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Jan14_r2$Jan14_Final_CHL <- paste(ifelse(Jan14_r2$CHL < 45, ifelse(Jan14_r2$Gain10 < .8, Jan14_r2$CHL, Jan14_r2$NewCHL_g_1), ifelse(Jan14_r2$Gain1 < .8, Jan14_r2$CHL, Jan14_r2$NewCHL_gn1)))
Jan14_r2$Jan14_Final_CHL_note <- paste(ifelse(Jan14_r2$CHL < 45, ifelse(Jan14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Jan14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Feb14_r2$Feb14_Final_CHL <- paste(ifelse(Feb14_r2$CHL < 45, ifelse(Feb14_r2$Gain10 < .8, Feb14_r2$CHL, Feb14_r2$NewCHL_g_1), ifelse(Feb14_r2$Gain1 < .8, Feb14_r2$CHL, Feb14_r2$NewCHL_gn1)))
Feb14_r2$Feb14_Final_CHL_note <- paste(ifelse(Feb14_r2$CHL < 45, ifelse(Feb14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Feb14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Mar14_r2$Mar14_Final_CHL <- paste(ifelse(Mar14_r2$CHL < 45, ifelse(Mar14_r2$Gain10 < .8, Mar14_r2$CHL, Mar14_r2$NewCHL_g_1), ifelse(Mar14_r2$Gain1 < .8, Mar14_r2$CHL, Mar14_r2$NewCHL_gn1)))
Mar14_r2$Mar14_Final_CHL_note <- paste(ifelse(Mar14_r2$CHL < 45, ifelse(Mar14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Mar14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Apr14_r2$Apr14_Final_CHL <- paste(ifelse(Apr14_r2$CHL < 45, ifelse(Apr14_r2$Gain10 < .8, Apr14_r2$CHL, Apr14_r2$NewCHL_g_1), ifelse(Apr14_r2$Gain1 < .8, Apr14_r2$CHL, Apr14_r2$NewCHL_gn1)))
Apr14_r2$Apr14_Final_CHL_note <- paste(ifelse(Apr14_r2$CHL < 45, ifelse(Apr14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Apr14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
May14_r2$May14_Final_CHL <- paste(ifelse(May14_r2$CHL < 45, ifelse(May14_r2$Gain10 < .8, May14_r2$CHL, May14_r2$NewCHL_g_1), ifelse(May14_r2$Gain1 < .8, May14_r2$CHL, May14_r2$NewCHL_gn1)))
May14_r2$May14_Final_CHL_note <- paste(ifelse(May14_r2$CHL < 45, ifelse(May14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(May14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Jun14_r2$Jun14_Final_CHL <- paste(ifelse(Jun14_r2$CHL < 45, ifelse(Jun14_r2$Gain10 < .8, Jun14_r2$CHL, Jun14_r2$NewCHL_g_1), ifelse(Jun14_r2$Gain1 < .8, Jun14_r2$CHL, Jun14_r2$NewCHL_gn1)))
Jun14_r2$Jun14_Final_CHL_note <- paste(ifelse(Jun14_r2$CHL < 45, ifelse(Jun14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Jun14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Jul14_r2$Jul14_Final_CHL <- paste(ifelse(Jul14_r2$CHL < 45, ifelse(Jul14_r2$Gain10 < .8, Jul14_r2$CHL, Jul14_r2$NewCHL_g_1), ifelse(Jul14_r2$Gain1 < .8, Jul14_r2$CHL, Jul14_r2$NewCHL_gn1)))
Jul14_r2$Jul14_Final_CHL_note <- paste(ifelse(Jul14_r2$CHL < 45, ifelse(Jul14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Jul14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Aug14_r2$Aug14_Final_CHL <- paste(ifelse(Aug14_r2$CHL < 45, ifelse(Aug14_r2$Gain10 < .8, Aug14_r2$CHL, Aug14_r2$NewCHL_g_1), ifelse(Aug14_r2$Gain1 < .8, Aug14_r2$CHL, Aug14_r2$NewCHL_gn1)))
Aug14_r2$Aug14_Final_CHL_note <- paste(ifelse(Aug14_r2$CHL < 45, ifelse(Aug14_r2$Gain10 < .8, "Uncorrected chl", "Gain 10"), ifelse(Aug14_r2$Gain1 < .8, "Uncorrected chl", "Gain 1")))                      
Sep14_r2$Sep14_Final_CHL <- paste(ifelse(Sep14_r2$CHL <5, ifelse(Sep14_r2$Gain100 < .8,Sep14_r2$CHL, Sep14_r2$NewCHL_g_2),ifelse(Sep14_r2$CHL < 45, ifelse(Sep14_r2$Gain1 < .8, Sep14_r2$CHL, Sep14_r2$NewCHL_g_1), ifelse(Sep14_r2$Gain10 < .8, Sep14_r2$CHL, Sep14_r2$NewCHL_gn1)))) 
Sep14_r2$Sep14_Final_CHL_note <- paste(ifelse(Sep14_r2$CHL <5, ifelse(Sep14_r2$Gain100 < .8,"Uncorrected chl", "Gain 100"),ifelse(Sep14_r2$CHL < 45, ifelse(Sep14_r2$Gain1 < .8, "Uncorrected chl", "Gain 10"), ifelse(Sep14_r2$Gain10 < .8, "Uncorrected chl", "Gain 1"))))                   
Oct14_r2$Oct14_Final_CHL <- paste(ifelse(Oct14_r2$CHL <5, ifelse(Oct14_r2$Gain100 < .8,Oct14_r2$CHL, Oct14_r2$NewCHL_g_2),ifelse(Oct14_r2$CHL < 45, ifelse(Oct14_r2$Gain1 < .8, Oct14_r2$CHL, Oct14_r2$NewCHL_g_1), ifelse(Oct14_r2$Gain10 < .8, Oct14_r2$CHL, Oct14_r2$NewCHL_gn1)))) 
Oct14_r2$Oct14_Final_CHL_note <- paste(ifelse(Oct14_r2$CHL <5, ifelse(Oct14_r2$Gain100 < .8,"Uncorrected chl", "Gain 100"),ifelse(Oct14_r2$CHL < 45, ifelse(Oct14_r2$Gain1 < .8, "Uncorrected chl", "Gain 10"), ifelse(Oct14_r2$Gain10 < .8, "Uncorrected chl", "Gain 1"))))                   
Nov14_r2$Nov14_Final_CHL <- paste(ifelse(Nov14_r2$CHL <5, ifelse(Nov14_r2$Gain100 < .8,Nov14_r2$CHL, Nov14_r2$NewCHL_g_2),ifelse(Nov14_r2$CHL < 45, ifelse(Nov14_r2$Gain1 < .8, Nov14_r2$CHL, Nov14_r2$NewCHL_g_1), ifelse(Nov14_r2$Gain10 < .8, Nov14_r2$CHL, Nov14_r2$NewCHL_gn1)))) 
Nov14_r2$Nov14_Final_CHL_note <- paste(ifelse(Nov14_r2$CHL <5, ifelse(Nov14_r2$Gain100 < .8,"Uncorrected chl", "Gain 100"),ifelse(Nov14_r2$CHL < 45, ifelse(Nov14_r2$Gain1 < .8, "Uncorrected chl", "Gain 10"), ifelse(Nov14_r2$Gain10 < .8, "Uncorrected chl", "Gain 1"))))                   
Dec14_r2$Dec14_Final_CHL <- paste(ifelse(Dec14_r2$CHL <5, ifelse(Dec14_r2$Gain100 < .8,Dec14_r2$CHL, Dec14_r2$NewCHL_g_2),ifelse(Dec14_r2$CHL < 45, ifelse(Dec14_r2$Gain1 < .8, Dec14_r2$CHL, Dec14_r2$NewCHL_g_1), ifelse(Dec14_r2$Gain10 < .8, Dec14_r2$CHL, Dec14_r2$NewCHL_gn1)))) 
Dec14_r2$Dec14_Final_CHL_note <- paste(ifelse(Dec14_r2$CHL <5, ifelse(Dec14_r2$Gain100 < .8,"Uncorrected chl", "Gain 100"),ifelse(Dec14_r2$CHL < 45, ifelse(Dec14_r2$Gain1 < .8, "Uncorrected chl", "Gain 10"), ifelse(Dec14_r2$Gain10 < .8, "Uncorrected chl", "Gain 1"))))                   

#Merge to one file
a <- join(blank, Mar13_r2, by="MEASURE",type="left")
b <- join(a, Apr13_r2, by="MEASURE",type="left")
c <- join(b, May13_r2, by="MEASURE",type="left")
d <- join(c, Jun13_r2, by="MEASURE",type="left")
e <- join(d, Jul13_r2, by="MEASURE",type="left")
f <- join(e, Aug13_r2, by="MEASURE",type="left")
g <- join(f, Sep13_r2, by="MEASURE",type="left")
h <- join(g, Oct13_r2, by="MEASURE",type="left")
i <- join(h, Nov13_r2, by="MEASURE",type="left")
j <- join(i, Dec13_r2, by="MEASURE",type="left")
k <- join(j, Jan14_r2, by="MEASURE",type="left")
l <- join(k, Feb14_r2, by="MEASURE",type="left")
m <- join(l, Mar14_r2, by="MEASURE",type="left")
n <- join(m, Apr14_r2, by="MEASURE",type="left")
o <- join(n, May14_r2, by="MEASURE",type="left")
p <- join(o, Jun14_r2, by="MEASURE",type="left")
q <- join(p, Jul14_r2, by="MEASURE",type="left")
r <- join(q, Aug14_r2, by="MEASURE",type="left")
s <- join(r, Sep14_r2, by="MEASURE",type="left")
t <- join(s, Oct14_r2, by="MEASURE",type="left")
u <- join(t, Nov14_r2, by="MEASURE",type="left")
wq <- join(u, Dec14_r2, by="MEASURE",type="left")

wq1 <- subset(wq, select=c(RID, Labels, Mar13_Final_CHL, Apr13_Final_CHL, 
                         May13_Final_CHL, Jun13_Final_CHL, Jul13_Final_CHL, Aug13_Final_CHL, Sep13_Final_CHL, 
                         Oct13_Final_CHL, Nov13_Final_CHL, Dec13_Final_CHL, Jan14_Final_CHL, Feb14_Final_CHL, 
                         Mar14_Final_CHL, Apr14_Final_CHL, May14_Final_CHL, Jun14_Final_CHL, Jul14_Final_CHL,
                         Aug14_Final_CHL, Sep14_Final_CHL, Oct14_Final_CHL, Nov14_Final_CHL, Dec14_Final_CHL))

wq2 <- subset(wq, select=c(RID, Labels, Mar13_Final_CHL, Mar13_Final_CHL_note, Apr13_Final_CHL, Apr13_Final_CHL_note, 
                          May13_Final_CHL, May13_Final_CHL_note, Jun13_Final_CHL, Jun13_Final_CHL_note, Jul13_Final_CHL, Jul13_Final_CHL_note, Aug13_Final_CHL, Aug13_Final_CHL_note, Sep13_Final_CHL, Sep13_Final_CHL_note, 
                          Oct13_Final_CHL, Oct13_Final_CHL_note, Nov13_Final_CHL, Nov13_Final_CHL_note, Dec13_Final_CHL, Dec13_Final_CHL_note, Jan14_Final_CHL, Jan14_Final_CHL_note, Feb14_Final_CHL, Feb14_Final_CHL_note, 
                          Mar14_Final_CHL, Mar14_Final_CHL_note, Apr14_Final_CHL, Apr14_Final_CHL_note, May14_Final_CHL, May14_Final_CHL_note, Jun14_Final_CHL, Jun14_Final_CHL_note, Jul14_Final_CHL, Jul14_Final_CHL_note,
                          Aug14_Final_CHL, Aug14_Final_CHL_note, Sep14_Final_CHL, Sep14_Final_CHL_note, Oct14_Final_CHL, Oct14_Final_CHL_note, Nov14_Final_CHL, Nov14_Final_CHL_note, Dec14_Final_CHL, Dec14_Final_CHL_note))

write.csv(wq1, "X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Final_CHL_wqtst.csv")

write.csv(wq2, "X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Final_CHL_wqtst_with_notes.csv")

wqsb <- subset(wq, select=c(Mar13_Final_CHL, Apr13_Final_CHL, 
                           May13_Final_CHL, Jun13_Final_CHL, Jul13_Final_CHL, Aug13_Final_CHL, Sep13_Final_CHL, 
                           Oct13_Final_CHL, Nov13_Final_CHL, Dec13_Final_CHL, Jan14_Final_CHL, Feb14_Final_CHL, 
                           Mar14_Final_CHL, Apr14_Final_CHL, May14_Final_CHL, Jun14_Final_CHL, Jul14_Final_CHL,
                           Aug14_Final_CHL, Sep14_Final_CHL, Oct14_Final_CHL, Nov14_Final_CHL, Dec14_Final_CHL))

wqsb2 <- subset(wq1, select=c(Labels))

##Convert to matrix & flip
wqsbmat <- data.matrix(wqsb, rownames.force = NA )
wqsbmat.r <-apply(wqsbmat,2,rev)

##Set colors and labels
col1 <- colorRampPalette(c("blue","green","yellow","orange","red"), space = "rgb")
col2 <- colorRampPalette(c("black","blue","green","yellow","orange","red"), space = "rgb")
labels <- c("Mar13","Apr13","May13","Jun13","Jul13","Aug13","Sep13", "Oct13","Nov13","Dec13","Jan14","Feb14","Mar14","Apr14","May14","Jun14","Jul14","Aug14","Sep14", "Oct14", "Nov14", "Dec14")

##Display heatmap
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/Arc_Final_CHL_SB.tiff")
hmwqsb <- heatmap.2(wqsbmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_Final_CHL", col=col1,labCol=labels,labRow=rev(wqsb2$Labels),cexRow=1.6, breaks=seq(0,30,by=0.025))
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/Arc_Final_CHL_SB_over20.tiff")
hmwqsb <- heatmap.2(wqsbmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_Final_CHL", col=col1,labCol=labels,labRow=rev(wqsb2$Labels),cexRow=1.6, breaks=seq(0,20,by=0.025))
dev.off()
