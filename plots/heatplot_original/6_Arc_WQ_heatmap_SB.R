####Production of heatmap of wq

library(plyr)
library(gplots)
library(grDevices)

####To start producing heatmaps

#Open datasets (site example, site list: SB,CC,LN,CA,UL,HS,HSPC,SB,MZ,NSDV,BR)
blank <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_BLANK_SBwqtst.csv")
Mar13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Mar2013_SBwqtst.csv")
Apr13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Apr2013_SBwqtst.csv")
May13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_May2013_SBwqtst.csv")
Jun13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jun2013_SBwqtst.csv")
Jul13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jul2013_SBwqtst.csv")
Aug13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Aug2013_SBwqtst.csv")
Sep13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Sep2013_SBwqtst.csv")
Oct13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Oct2013_SBwqtst.csv")
Nov13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Nov2013_SBwqtst.csv")
Dec13 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Dec2013_SBwqtst.csv")
Jan14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jan2014_SBwqtst.csv")
Feb14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Feb2014_SBwqtst.csv")
Mar14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Mar2014_SBwqtst.csv")
Apr14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Apr2014_SBwqtst.csv")
May14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_May2014_SBwqtst.csv")
Jun14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jun2014_SBwqtst.csv")
Jul14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Jul2014_SBwqtst.csv")
Aug14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Aug2014_SBwqtst.csv")
Sep14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Sep2014_SBwqtst.csv")
Oct14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Oct2014_SBwqtst.csv")
Nov14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Nov2014_SBwqtst.csv")
Dec14 <- read.csv("X:/ArcProject/Arc_Heatmaps/Arc_wqt_snapped_corrected/Arc_Dec2014_SBwqtst.csv")

#Workaround to make sure MEASURE column match eachother - this is done to facilitate join
blank$MEASURE <-paste(round(blank$MEASURE))
Mar13$MEASURE <-paste(round(Mar13$MEAS))
Apr13$MEASURE <-paste(round(Apr13$MEAS))
May13$MEASURE <-paste(round(May13$MEAS))
Jun13$MEASURE <-paste(round(Jun13$MEAS))
Jul13$MEASURE <-paste(round(Jul13$MEAS))
Aug13$MEASURE <-paste(round(Aug13$MEAS))
Sep13$MEASURE <-paste(round(Sep13$MEAS))
Oct13$MEASURE <-paste(round(Oct13$MEAS))
Nov13$MEASURE <-paste(round(Nov13$MEAS))
Dec13$MEASURE <-paste(round(Dec13$MEAS))
Jan14$MEASURE <-paste(round(Jan14$MEAS))
Feb14$MEASURE <-paste(round(Feb14$MEAS))
Mar14$MEASURE <-paste(round(Mar14$MEAS))
Apr14$MEASURE <-paste(round(Apr14$MEAS))
May14$MEASURE <-paste(round(May14$MEAS))
Jun14$MEASURE <-paste(round(Jun14$MEAS))
Jul14$MEASURE <-paste(round(Jul14$MEAS))
Aug14$MEASURE <-paste(round(Aug14$MEAS))
Sep14$MEASURE <-paste(round(Sep14$MEAS))
Oct14$MEASURE <-paste(round(Oct14$MEAS))
Nov14$MEASURE <-paste(round(Nov14$MEAS))
Dec14$MEASURE <-paste(round(Dec14$MEAS))


#Merge to one file
a <- join(blank, Mar13, by="MEASURE",type="left")
b <- join(a, Apr13, by="MEASURE",type="left")
c <- join(b, May13, by="MEASURE",type="left")
d <- join(c, Jun13, by="MEASURE",type="left")
e <- join(d, Jul13, by="MEASURE",type="left")
f <- join(e, Aug13, by="MEASURE",type="left")
g <- join(f, Sep13, by="MEASURE",type="left")
h <- join(g, Oct13, by="MEASURE",type="left")
i <- join(h, Nov13, by="MEASURE",type="left")
j <- join(i, Dec13, by="MEASURE",type="left")
k <- join(j, Jan14, by="MEASURE",type="left")
l <- join(k, Feb14, by="MEASURE",type="left")
m <- join(l, Mar14, by="MEASURE",type="left")
n <- join(m, Apr14, by="MEASURE",type="left")
o <- join(n, May14, by="MEASURE",type="left")
p <- join(o, Jun14, by="MEASURE",type="left")
q <- join(p, Jul14, by="MEASURE",type="left")
r <- join(q, Aug14, by="MEASURE",type="left")
s <- join(r, Sep14, by="MEASURE",type="left")
t <- join(s, Oct14, by="MEASURE",type="left")
u <- join(t, Nov14, by="MEASURE",type="left")
wq1 <- join(u, Dec14, by="MEASURE",type="left")

#Condense dataframe to parameters of interest (Temp, SpCond, Sal, DOperc, DO, CHL, pH, TurbSC, NewCHL). 
#Make sure to add each month here.
CHL <- data.frame(wq1$Mar2013_CHL, wq1$Apr2013_CHL, wq1$May2013_CHL, wq1$Jun2013_CHL, wq1$Jul2013_CHL, wq1$Aug2013_CHL,wq1$Sep2013_CHL,wq1$Oct2013_CHL,wq1$Nov2013_CHL,wq1$Dec2013_CHL, wq1$Jan2014_CHL, wq1$Feb2014_CHL, wq1$Mar2014_CHL, wq1$Apr2014_CHL, wq1$May2014_CHL, wq1$Jun2014_CHL, wq1$Jul2014_CHL, wq1$Aug2014_CHL, wq1$Sep2014_CHL, wq1$Oct2014_CHL, wq1$Nov2014_CHL, wq1$Dec2014_CHL)


######NEED TO ADD CODE TO MAKE FINAL HEATMAP
CHL_gn0 <- data.frame(wq1$Mar2013_CHL_gn0, wq1$Apr2013_CHL_gn0, wq1$May2013_CHL_gn0, wq1$Jun2013_CHL_gn0, wq1$Jul2013_CHL_gn0)
CHL_gn1 <- data.frame(wq1$Aug2013_CHL_gn1,wq1$Sep2013_CHL_gn1,wq1$Oct2013_CHL_gn1,wq1$Nov2013_CHL_gn1,wq1$Dec2013_CHL_gn1,wq1$Jan2014_CHL_gn1, wq1$Feb2014_CHL_gn1, wq1$Mar2014_CHL_gn1, wq1$Apr2014_CHL_gn1, wq1$May2014_CHL_gn1, wq1$Jun2014_CHL_gn1, wq1$Jul2014_CHL_gn1, wq1$Aug2014_CHL_gn1, wq1$Sep2014_CHL_gn1, wq1$Oct2014_CHL_gn1, wq1$Nov2014_CHL_gn1, wq1$Dec2014_CHL_gn1)
CHL_gn10 <- data.frame(wq1$Aug2013_CHL_gn10,wq1$Sep2013_CHL_gn10,wq1$Oct2013_CHL_gn10,wq1$Nov2013_CHL_gn10,wq1$Dec2013_CHL_gn10, wq1$Jan2014_CHL_gn10, wq1$Feb2014_CHL_gn10, wq1$Mar2014_CHL_gn10, wq1$Apr2014_CHL_gn10, wq1$May2014_CHL_gn10, wq1$Jun2014_CHL_gn10, wq1$Jul2014_CHL_gn10, wq1$Aug2014_CHL_gn10, wq1$Sep2014_CHL_gn10, wq1$Oct2014_CHL_gn10, wq1$Nov2014_CHL_gn10, wq1$Dec2014_CHL_gn10)
CHL_gn100 <- data.frame(wq1$Sep2014_CHL_gn100, wq1$Oct2014_CHL_gn100, wq1$Nov2014_CHL_gn100, wq1$Dec2014_CHL_gn100)
TurbSC <- data.frame(wq1$Mar2013_TurbSC, wq1$Apr2013_TurbSC, wq1$May2013_TurbSC, wq1$Jun2013_TurbSC, wq1$Jul2013_TurbSC, wq1$Aug2013_TurbSC,wq1$Sep2013_TurbSC,wq1$Oct2013_TurbSC,wq1$Nov2013_TurbSC,wq1$Dec2013_TurbSC, wq1$Jan2014_TurbSC, wq1$Feb2014_TurbSC, wq1$Mar2014_TurbSC, wq1$Apr2014_TurbSC, wq1$May2014_TurbSC, wq1$Jun2014_TurbSC, wq1$Jul2014_TurbSC, wq1$Aug2014_TurbSC, wq1$Sep2014_TurbSC, wq1$Oct2014_TurbSC, wq1$Nov2014_TurbSC, wq1$Dec2014_TurbSC)
Temp <- data.frame(wq1$Mar2013_Temp, wq1$Apr2013_Temp, wq1$May2013_Temp, wq1$Jun2013_Temp, wq1$Jul2013_Temp, wq1$Aug2013_Temp,wq1$Sep2013_Temp,wq1$Oct2013_Temp,wq1$Nov2013_Temp,wq1$Dec2013_Temp, wq1$Jan2014_Temp, wq1$Feb2014_Temp, wq1$Mar2014_Temp, wq1$Apr2014_Temp, wq1$May2014_Temp, wq1$Jun2014_Temp, wq1$Jul2014_Temp, wq1$Aug2014_Temp, wq1$Sep2014_Temp, wq1$Oct2014_Temp, wq1$Nov2014_Temp, wq1$Dec2014_Temp)
Sal <- data.frame(wq1$Mar2013_Sal, wq1$Apr2013_Sal, wq1$May2013_Sal, wq1$Jun2013_Sal, wq1$Jul2013_Sal, wq1$Aug2013_Sal,wq1$Sep2013_Sal,wq1$Oct2013_Sal,wq1$Nov2013_Sal,wq1$Dec2013_Sal, wq1$Jan2014_Sal, wq1$Feb2014_Sal, wq1$Mar2014_Sal, wq1$Apr2014_Sal, wq1$May2014_Sal, wq1$Jun2014_Sal, wq1$Jul2014_Sal, wq1$Aug2014_Sal, wq1$Sep2014_Sal, wq1$Oct2014_Sal, wq1$Nov2014_Sal, wq1$Dec2014_Sal)
DO <- data.frame(wq1$Mar2013_DO, wq1$Apr2013_DO, wq1$May2013_DO, wq1$Jun2013_DO, wq1$Jul2013_DO, wq1$Aug2013_DO,wq1$Sep2013_DO,wq1$Oct2013_DO,wq1$Nov2013_DO,wq1$Dec2013_DO, wq1$Jan2014_DO, wq1$Feb2014_DO, wq1$Mar2014_DO, wq1$Apr2014_DO, wq1$May2014_DO, wq1$Jun2014_DO, wq1$Jul2014_DO, wq1$Aug2014_DO, wq1$Sep2014_DO, wq1$Oct2014_DO, wq1$Nov2014_DO, wq1$Dec2014_DO)
DOPerc <- data.frame(wq1$Mar2013_DOPerc, wq1$Apr2013_DOPerc, wq1$May2013_DOPerc, wq1$Jun2013_DOPerc, wq1$Jul2013_DOPerc, wq1$Aug2013_DOPerc,wq1$Sep2013_DOPerc,wq1$Oct2013_DOPerc,wq1$Nov2013_DOPerc,wq1$Dec2013_DOPerc, wq1$Jan2014_DOPerc, wq1$Feb2014_DOPerc, wq1$Mar2014_DOPerc, wq1$Apr2014_DOPerc, wq1$May2014_DOPerc, wq1$Jun2014_DOPerc, wq1$Jul2014_DOPerc, wq1$Aug2014_DOPerc, wq1$Sep2014_DOPerc, wq1$Oct2014_DOPerc, wq1$Nov2014_DOPerc, wq1$Dec2014_DOPerc)
SpCond <- data.frame(wq1$Mar2013_SpCond, wq1$Apr2013_SpCond, wq1$May2013_SpCond, wq1$Jun2013_SpCond, wq1$Jul2013_SpCond, wq1$Aug2013_SpCond,wq1$Sep2013_SpCond,wq1$Oct2013_SpCond,wq1$Nov2013_SpCond,wq1$Dec2013_SpCond, wq1$Jan2014_SpCond, wq1$Feb2014_SpCond, wq1$Mar2014_SpCond, wq1$Apr2014_SpCond, wq1$May2014_SpCond, wq1$Jun2014_SpCond, wq1$Jul2014_SpCond, wq1$Aug2014_SpCond, wq1$Sep2014_SpCond, wq1$Oct2014_SpCond, wq1$Nov2014_SpCond, wq1$Dec2014_SpCond)
pH <- data.frame(wq1$Mar2013_pH, wq1$Apr2013_pH, wq1$May2013_pH, wq1$Jun2013_pH, wq1$Jul2013_pH, wq1$Aug2013_pH,wq1$Sep2013_pH,wq1$Oct2013_pH,wq1$Nov2013_pH,wq1$Dec2013_pH, wq1$Jan2014_pH, wq1$Feb2014_pH, wq1$Mar2014_pH, wq1$Apr2014_pH, wq1$May2014_pH, wq1$Jun2014_pH, wq1$Jul2014_pH, wq1$Aug2014_pH, wq1$Sep2014_pH, wq1$Oct2014_pH, wq1$Nov2014_pH, wq1$Dec2014_pH)
write.csv(CHL, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtCHL.csv")
write.csv(CHL_gn0 , "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtCHL_gn0.csv")
write.csv(CHL_gn1 , "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtCHL_gn1.csv")
write.csv(CHL_gn10 , "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtCHL_gn10.csv")
write.csv(CHL_gn100 , "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtCHL_gn100.csv")
write.csv(TurbSC, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtTurbSC.csv")
write.csv(Temp, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtTemp.csv")
write.csv(Sal, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtSal.csv")
write.csv(DO, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtDO.csv")
write.csv(DOPerc, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtDOPerc.csv")
write.csv(SpCond, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtSpCond.csv")
write.csv(pH, "X:/ArcProject/Arc_Heatmaps/Parameter_sumMary/Arc_SBwqtpH.csv")

##Convert to matrix & flip
CHLmat <- as.matrix(CHL)
CHLmat.r <-apply(CHLmat,2,rev)
CHL_gn0mat <- as.matrix(CHL_gn0)
CHL_gn0mat.r <-apply(CHL_gn0mat,2,rev)
CHL_gn1mat <- as.matrix(CHL_gn1)
CHL_gn1mat.r <-apply(CHL_gn1mat,2,rev)
CHL_gn10mat <- as.matrix(CHL_gn10)
CHL_gn10mat.r <-apply(CHL_gn10mat,2,rev)
CHL_gn100mat <- as.matrix(CHL_gn100)
CHL_gn100mat.r <-apply(CHL_gn100mat,2,rev)
TurbSCmat <- as.matrix(TurbSC)
TurbSCmat.r <-apply(TurbSCmat,2,rev)
Tempmat <- as.matrix(Temp)
Tempmat.r <-apply(Tempmat,2,rev)
Salmat <- as.matrix(Sal)
Salmat.r <-apply(Salmat,2,rev)
DOmat <- as.matrix(DO)
DOmat.r <-apply(DOmat,2,rev)
DOPercmat <- as.matrix(DOPerc)
DOPercmat.r <-apply(DOPercmat,2,rev)
SpCondmat <- as.matrix(SpCond)
SpCondmat.r <-apply(SpCondmat,2,rev)
pHmat <- as.matrix(pH)
pHmat.r <-apply(pHmat,2,rev)
labels <- c("Mar13","Apr13","May13","Jun13","Jul13","Aug13","Sep13", "Oct13","Nov13","Dec13","Jan14","Feb14","Mar14","Apr14","May14","Jun14","Jul14","Aug14","Sep14","Oct14","Nov14","Dec14")
labelsgn0 <- c("Mar13","Apr13","May13","Jun13","Jul13")
labelsgn1_10 <- c("Aug13","Sep13", "Oct13","Nov13","Dec13","Jan14","Feb14","Mar14","Apr14","May14","Jun14","Jul14","Aug14","Sep14","Oct14","Nov14","Dec14")
labelsgn100 <- c("Sep14","Oct14","Nov14","Dec14")


##Set colors
col1 <- colorRampPalette(c("blue","green","yellow","orange","red"), space = "rgb")
col2 <- colorRampPalette(c("black","blue","green","yellow","orange","red"), space = "rgb")

##Display heatmap
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_CHL.tiff") #start to saving tiff
hmCHL <- heatmap.2(CHLmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_CHL", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6,breaks=seq(0,35,by=0.025))
dev.off() #end to saving jpeg
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_CHL_gn0.tiff")
hmCHL_gn0 <- heatmap.2(CHL_gn0mat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_CHL_gn0", col=col1,labCol=labelsgn0,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_CHL_gn1.tiff")
hmCHL_gn1 <- heatmap.2(CHL_gn1mat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_CHL_gn1", col=col1,labCol=labelsgn1_10,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_CHL_gn10.tiff")
hmCHL_gn10 <- heatmap.2(CHL_gn10mat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_CHL_gn10", col=col1,labCol=labelsgn1_10,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_CHL_gn100.tiff")
hmCHL_gn100 <- heatmap.2(CHL_gn100mat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_CHL_gn100", col=col1,labCol=labelsgn100,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_TurbSC.tiff")
hmTurbSC <- heatmap.2(TurbSCmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_TurbSC", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6,breaks=seq(0,100,by=0.025))
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_Temp.tiff")
hmTemp <- heatmap.2(Tempmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_Temp", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_Sal.tiff")
hmSal <- heatmap.2(Salmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_Sal", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_DO.tiff")
hmDO <- heatmap.2(DOmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_DO", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_DOPerc.tiff")
hmDOPerc <- heatmap.2(DOPercmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_DOperc", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_SpCond.tiff")
hmSpCond <- heatmap.2(SpCondmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_SpCond", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()
tiff(file="X:/ArcProject/Arc_Heatmaps/Arc_Heatmaps/SB_pH.tiff")
hmpH <- heatmap.2(pHmat.r,Rowv=NULL,Colv=NULL,dendrogram=c("none"),trace="none",density.info="none", main="SB_pH", col=col1,labCol=labels,labRow=rev(wq1$Labels),cexRow=1.6)
dev.off()






